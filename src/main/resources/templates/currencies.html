<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Valute</title>
</head>
<body>
<section layout:fragment="content">
    <h1 class="text-2xl font-bold mb-4">Valute</h1>

    <h2 class="text-xl mb-2">Dodaj novu valutu</h2>
    <form th:action="@{/currencies/add}" th:object="${currency}" method="post" class="space-y-2">
        <label class="block">Kod:
            <input type="text" th:field="*{code}" class="border p-2 rounded w-full" required/>
        </label>
        <label class="block">Naziv:
            <input type="text" th:field="*{name}" class="border p-2 rounded w-full" required/>
        </label>
        <label class="block">Država:
            <input type="text" th:field="*{country}" class="border p-2 rounded w-full" required/>
        </label>
        <label class="block">Kurs prema bazi:
            <input type="number" step="0.01" th:field="*{rateToBase}" class="border p-2 rounded w-full" required/>
        </label>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Dodaj</button>
    </form>

    <h2 class="text-xl mt-6 mb-2">Lista valuta</h2>
    <table class="w-full border-collapse border border-gray-400">
        <thead class="bg-gray-200">
        <tr>
            <th class="border p-2">Kod</th>
            <th class="border p-2">Naziv</th>
            <th class="border p-2">Država</th>
            <th class="border p-2">Kurs</th>
            <th class="border p-2"></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="currency : ${currencies}" class="hover:bg-gray-100">
            <td class="border p-2" th:text="${currency.code}"></td>
            <td class="border p-2" th:text="${currency.name}"></td>
            <td class="border p-2" th:text="${currency.country}"></td>
            <td class="border p-2" th:text="${currency.rateToBase}"></td>
            <td class="border p-2 text-center space-x-2">
                <button type="button" class="bg-yellow-500 text-white px-2 py-1 rounded"
                        th:attr="data-code=${currency.code},
                                 data-name=${currency.name},
                                 data-country=${currency.country},
                                 data-rate=${currency.rateToBase}"
                        onclick="openEditModal(this)">
                    Izmeni
                </button>

                <form th:action="@{/currencies/delete/{code}(code=${currency.code})}" method="post"
                      style="display:inline">
                    <button type="submit" class="bg-red-600 text-white px-2 py-1 rounded"
                            onclick="return confirm('Da li ste sigurni da želite da obrišete ovu valutu?')">
                        Obriši
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:replace="~{fragments/editCurrency :: editCurrencyModal}"></div>

    <script>
        function openEditModal(button) {
            const code = button.dataset.code;
            const name = button.dataset.name;
            const country = button.dataset.country;
            const rate = button.dataset.rate;

            document.getElementById("editCode").value = code;
            document.getElementById("editName").value = name;
            document.getElementById("editCountry").value = country;
            document.getElementById("editRate").value = rate;

            document.getElementById("editModal").classList.remove("hidden");
        }

        function closeEditModal() {
            document.getElementById("editModal").classList.add("hidden");
        }
    </script>
</section>
</body>
</html>